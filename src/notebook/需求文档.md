# 1. 业务领域划分
国贸+移动端的底层数据来源为合同明细和结算单明细。
通过对底层数据的加工，得到了反映业务不同领域的指标。
报表系统以不同的维度和跨度对指标做可视化的呈现。
为了实现业务领域解耦合，分批推进产品的开发、测试和上线工作，将指标按业务领域聚类。划分为如下的领域和指标：
- **业绩**
	- 销售额
	- 采购额
	- 毛利润
	- 毛利率
- **库存**
	- 煤炭库存
		- 库存重量
		- 暂估库存货值
		- 预付货款
	- 钢材库存
		- 库存数量
		- 库存重量
		- 存货金额余额
- **代采**
	- 客户存货金额余额
- **回款**
	- 回款金额
- **应收**
	- 应收余额
- **帐龄**
	- 账款金额
- ~~风险:涉及各种异常状态的风险提示,暂不接入.~~
- ~~合同:关注合同执行状态,暂不接入.~~
- ~~下游客户属性:审批额度,剩余额度,平均帐龄,逾期超过90天的金额等信息.~~
其中业绩,回款,帐龄属于**时间序列型**数据，每一行数据都有一个时间字段.查询的参数提取中必须包含时间范围.
库存,代采,应收属于**快照型**数据,每个公司,仓库,客户只保留最新的一条数据.查询的参数提取中不需要指明时间范围.
# 2. 业绩领域指标说明
## 数据视图字段说明
- **销售金额**:公司向下游客户出售商品的销售合同的结算金额，为数值类型，单位为元。
- **采购金额**:公司向上游供应商采购商品的采购合同的结算金额，为数值类型，单位为元。
- **毛利润**: $$毛利润=\sum销售额-\sum 采购额$$
- **毛利率**: $$毛利率=\frac{毛利润}{\sum 销售额} $$
保留四位小数.
- **公司名称**:为以下列表中的某一个,图表中显示为简称：
```json
company_short_names = {
"湖北国贸能源化工有限公司": "国贸能化",
"湖北国贸金属矿产有限公司": "国贸金属矿",
"湖北国贸汽车有限公司": "国贸汽车",
"湖北国际贸易集团有限公司": "国贸集团",
"湖北国贸农产品有限公司": "国贸农产品",
"武汉鼎联丰国际贸易有限公司": "鼎联丰",
"湖北国贸农产品有限公司武汉分公司": "国贸农产武汉",
"湖北南方大集实业有限公司": "南方大集",
"湖北南方大集实业有限公司东西湖分公司": "南方大集东西湖",
"湖北南方大集实业有限公司慈惠分公司": "南方大集慈惠",
"湖北南方大集实业有限公司江汉分公司": "南方大集江汉",
"湖北南方大集实业有限公司能源分公司": "南方大集能源",
"湖北南方工贸有限公司": "南方工贸",
"湖北南方集团有限公司": "南方集团",
"湖北国贸供应链管理有限公司": "国贸供应链",
"湖北华中能源发展有限公司": "华中能源",
"湖北国贸汽车有限公司红安分公司": "国贸汽车红安",
}
```
- **客户名称**:为销售合同中下游购货公司的名称
- **销售结算日期**:销售结算事件发生的日期,格式为"yyyy-mm-dd"
- **采购结算日期**:采购结算事件发生的日期,格式为"yyyy-mm-dd"
- **商品类别**: 枚举值,目前只能取**煤炭**或**钢材**
## 数据库视图示例
### 业绩视图宽表示例

| 公司名称   | 客户名称 | 销售金额         | 采购金额        | 毛利润       |  毛利率    | 销售结算日期      | 采购结算日期      | 商品类别 |
| ------ | ---- | ------------ | ----------- | --------- | ------- | ----------- | ----------- | ---- |
| 国贸能化   |  客户A | 3245678.90   | 3000000.00  | 245678.90 | 0.0756  |  2024-03-15 |  2024-01-05 | 煤炭   |
| 国贸金属矿  | 客户B  | 1987654.32   | 1800000.00  | 187654.32 | 0.0944  | 2024-03-18  | 2024-01-12  | 钢材   |
| 国贸汽车   | 客户C  | 5678901.23   | 5200000.00  | 478901.23 | 0.0842  |  2024-03-20 | 2024-01-15  | 钢材   |
| 国贸集团   | 客户D  | 2345678.90   | 2100000.00  | 245678.90 | 0.1047  |  2024-03-22 | 2024-01-18  | 煤炭   |
| 国贸农产品  |  客户E |  4567890.12  | 4200000.00  | 367890.12 | 0.0805  | 2024-03-25  | 2024-01-20  | 煤炭   |
| 鼎联丰    | 客户F  | 3456789.01   |  3200000.00 | 256789.01 | 0.0743  | 2024-03-28  | 2024-01-23  | 钢材   |
| 国贸农产武汉 | 客户G  | 2345678.90   | 2100000.00  | 245678.90 | 0.1047  | 2024-03-30  | 2024-01-25  | 煤炭   |
| 南方大集   | 客户H  | 5678901.23   |  5200000.00 | 478901.23 | 0.0842  | 2024-04-02  | 2024-01-28  | 钢材   |
| 国贸供应链  | 客户I  | 3456789.01   | 3200000.00  | 256789.01 | 0.0743  | 2024-04-05  |  2024-01-31 | 煤炭   |
| 华中能源   | 客户J  |  4567890.12  | 4200000.00  | 367890.12 | 0.0805  | 2024-04-08  | 2024-02-03  | 钢材   |

### 销售额透视视图
  
| 公司名称   | 客户名称 | 销售金额       | 销售结算日期     | 商品类别 |
| ------ | ---- | ---------- | ---------- | ---- |
| 国贸能源化工 | 客户12 | 3512543.70 | 2024-03-15 | 煤炭   |
| 国贸金属矿  | 客户5  | 1280000.00 | 2023-11-20 | 钢材   |
| 国贸汽车   | 客户31 | 2105678.90 | 2024-01-07 | 钢材   |
| 国贸集团   | 客户8  | 4321098.76 | 2023-09-30 | 煤炭   |
| 国贸农产   | 客户19 | 987654.32  | 2024-02-28 | 煤炭   |
| 鼎联丰    | 客户42 | 1765432.10 | 2023-12-12 | 钢材   |
| 南方大集   | 客户3  | 3210987.65 | 2024-04-05 | 煤炭   |
| 国贸供应链  | 客户27 | 2345678.90 | 2023-10-18 | 钢材   |
 
### 采购额视图

| 公司名称   | 客户名称 | 采购金额       | 采购结算日期     | 商品类别 |
| ------ | ---- | ---------- | ---------- | ---- |
| 国贸能源化工 | 客户12 | 3809034.96 | 2024-02-15 | 煤炭   |
| 国贸金属矿  | 客户5  | 1024000.00 | 2023-10-20 | 钢材   |
| 国贸汽车   | 客户31 | 1684543.12 | 2023-12-07 | 钢材   |
| 国贸集团   | 客户8  | 3456879.01 | 2023-08-30 | 煤炭   |
| 国贸农产   | 客户19 | 1090123.46 | 2024-01-28 | 煤炭   |
| 鼎联丰    | 客户42 | 1412345.68 | 2023-11-12 | 钢材   |
| 南方大集   | 客户3  | 2568790.12 | 2024-03-05 | 煤炭   |
| 国贸供应链  | 客户27 | 1876543.12 | 2023-09-18 | 钢材   |

 
### 毛利润,毛利率视图
毛利润毛利率计算规则说明:
**现行计算规则**:
$$毛利润=\sum销售额-\sum 采购额$$
$$毛利率=\frac{毛利润}{\sum 销售额} $$
**规划计算规则**:
考虑到:销售结算未达到100%进度的关联合同的毛利率为**失真**数据.(会出现很大的负数和波动)
因此后期能**跟踪销售结算进度**时,可将毛利润计算规则改为:
当销售合同发生销售结算的进度到达100%时触发毛利润和毛利率的计算和写入事务，此时的毛利润为最终数据.

| 公司名称   | 毛利率     | 毛利润        | 更新日期       |
| ------ | ------- | ---------- | ---------- |
| 国贸能源化工 | -0.0843 | -296491.26 | 2024-03-15 |
| 国贸金属矿  | 0.2000  | 256000.00  | 2023-11-20 |
| 国贸汽车   | 0.2000  | 421135.78  | 2024-01-07 |
| 国贸集团   | 0.2000  | 864219.75  | 2023-09-30 |
| 国贸农产   | -0.1038 | -102469.14 | 2024-02-28 |
| 鼎联丰    | 0.2000  | 353086.42  | 2023-12-12 |
| 南方大集   | 0.2000  | 642197.53  | 2024-04-05 |
| 国贸供应链  | 0.2000  | 469135.78  | 2023-10-18 |

## 结构化参数提取说明
- **指标名称**:
	- 类型:ENUM
	- 取值范围:
		- 销售额
		- 采购额
		- 毛利润
		- 毛利率
	- 是否必填:**是**
- **起始时间**:
	- 类型:DATE
	- 格式:yyyy-mm-dd
	- 是否必填:**是**
- **终止时间**:
	- 类型:DATE
	- 格式:yyyy-mm-dd
	- 是否必填:**是**
- **聚合类型**：
	- 类型:ENUM
	- 取值范围:
		- 时间维度:月,年
		- 名称维度:客户名称,公司名称
		- 说明:指标聚合GROUP BY的类型，其中按客户名称仅在公司名称参数不为空且客户名称为空时可选，公司名称仅在公司名称和客户名称均为空时可选。
	- 是否必填:**是**
- **排序方式**:
	- 类型:ENUM
	- 取值范围:
		- 升序:ASC
		- 降序:DESC
	- 是否必填:**否**
	- 说明:按时间排序的时候此字段为空
- **公司名称**:
	- 类型:ENUM
	- 取值范围:公司名称列表
	- 是否必填:**否**
	- 说明:如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值.比如A公司的用户默认是查询A公司的数据,但也可以显式的指定B公司的查询
- **客户名称**:
	- 类型:ENUM
	- 取值范围:客户名称列表
	- 是否必填:**否**
	- 说明:当用户指定查询具体的客户名称时取值.
- **商品类别**:
	- 类型:ENUM
	- 取值范围:煤炭,钢材
	- 是否必填:**否**
	- 说明:当用户指定查询具体的商品类别时取值.
- **运算符**:
	- 类型:ENUM
	- 取值范围:
		- ">"
		- "<"
		- ">=" 
		- "<="
		- "="
		- "IN" ,表示在a,b之间,闭区间
		- "NOT IN" ,表示不在a,b之间,开区间
	- 是否必填:**否**
- **值**:
	- 类型:DECIMAL
	- 说明:当运算符为IN或NOT IN时为[a,b]
	- 是否必填:**否**
## 结构化参数提取示例
### 例子1: 集团用户查询公司的销售额
- 用户输入: 今年上半年的销售情况.
- 构建会话上下文:
	```json
{
"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
"user_role":"GROUP",
"date":"2024-09-04",
"user_input":"今年上半年的销售情况.",
……
}
	```
- 输出:
	```json
{
  "指标名称": "销售额",
  "起始时间": "2024-01-01",
  "终止时间": "2024-06-30",
  "排序方式": "DESC",
  "聚合类型": "COMPANY"
}
	```
- 说明：
	- 用户身份为GROUP时聚合类型默认按COMPANY
- 图表:
	- ![[Pasted image 20240905112844.png]]


### 例子2:公司用户查询公司的销售额
- 用户输入: 去年的销售情况.
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"COMPANY",
	"user_company":"湖北国贸能源化工有限公司",
	"date":"2024-09-04",
	"user_input":"去年的销售情况.",
	……
	}
	```
- 输出:
	```json
	{
	  "指标名称": "销售额",
	  "起始时间": "2023-01-01",
	  "终止时间": "2023-12-31",
	  "聚合类型": "MONTH",
	  "公司名称":"湖北国贸能源化工有限公司",
	}
	```
- 说明：
	- 当用户角色为公司用户时且未指定公司时,公司名称取用户所属公司
	- 默认聚合类型为MONTH
- 图表
	- ![[Pasted image 20240905141023.png]]

### 例子3:集团用户按数值条件过滤公司的销售额
- 用户输入: 今年第一季度销售额大于5000万的公司.
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"GROUP",
	"date":"2024-09-04",
	"user_input":"今年第一季度销售额大于3000万的公司.",
	……
	}
	```
- 输出:
	```json
{
  "指标名称": "销售额",
  "起始时间": "2024-01-01",
  "终止时间": "2024-03-31",
  "排序方式": "DESC",
  "聚合类型": "COMPANY",
  "运算符":">",
  "值":"30000000",
}
	```
- 说明:
	- 用户身份为GROUP时聚合类型默认按COMPANY
- 图表:
	- ![[Pasted image 20240905114455.png]]

### 例子4:公司用户按数值条件过滤客户
- 用户输入: 去年的销售额大于300万的客户.
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"COMPANY",
	"user_company":"湖北国贸能源化工有限公司",
	"date":"2024-09-04",
	"user_input":"去年的销售额大于300万的客户.",
	……
	}
	```
- 输出:
	```json
{
  "指标名称": "销售额",
  "起始时间": "2023-01-01",
  "终止时间": "2023-12-31",
  "排序方式": "DESC",
  "聚合类型": "客户名称",
  "公司名称":"湖北国贸能源化工有限公司",
  "运算符":">",
  "值":"3000000",
}
	```
- 说明:
	- 用户身份为COMPANY时显式指定了聚合类型按客户名称
	- 公司名称取自用户所属公司
- 图表:
	- ![[Pasted image 20240905114904.png]]

### 例子5:公司用户按数值条件过滤满足条件的月份
- 用户输入: 今年的销售额大于1000万的月份.
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"COMPANY",
	"user_company":"湖北国贸能源化工有限公司",
	"date":"2024-09-04",
	"user_input":"今年的销售额大于1000万的月份.",
	……
	}
	```
- 输出:
	```json
	{
	  "指标名称": "销售额",
	  "起始时间": "2024-01-01",
	  "终止时间": "2024-09-04",
	  "聚合类型": "MONTH",
	  "公司名称":"湖北国贸能源化工有限公司",
	  "运算符":">",
	  "值":"10000000",
	}
	```
- 说明:
	- 用户身份为COMPANY时显式指定了聚合类型按客户名称
	- 公司名称取自用户所属公司
- 图表
	- ![[Pasted image 20240905114926.png]]

### 例子6: 集团用户查询各公司的采购额
- 用户输入: 今年第二季度各公司的采购情况。
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"GROUP",
	"date":"2024-09-04",
	"user_input":"今年第二季度各公司的采购情况。"
	}
	```
- 输出:
	```json
	{
	"指标名称": "采购额",
	"起始时间": "2024-04-01",
	"终止时间": "2024-06-30",
	"排序方式": "DESC",
	"聚合类型": "COMPANY"
	}
	```
- 图表:
	- ![[Pasted image 20240905173839.png]]
### 例子7: 集团用户查询高毛利润公司
- 用户输入: 去年毛利润超过1000万的公司。
- 构建会话上下文:
	```json
	{
	"session_id":"e4a7b8c9-76e0-4f71-8b95-2b6c3e2f6a73",
	"user_role":"GROUP",
	"date":"2024-09-04",
	"user_input":"去年毛利润超过1000万的公司。"
	}
	```
- 输出:
	```json
	{
	"指标名称": "毛利润",
	"起始时间": "2023-01-01",
	"终止时间": "2023-12-31",
	"排序方式": "DESC",
	"聚合类型": "COMPANY",
	"运算符": ">",
	"值": "10000000"
	}
	```
- 图表:
- ![[Pasted image 20240905173801.png]]
### 例子8: 公司用户查询毛利率
- 用户输入: 湖北国贸金属矿产有限公司今年以来的月度毛利率。
- 构建会话上下文:
- 
- 输出:
	```json
	{
	"指标名称": "毛利率",
	"起始时间": "2024-01-01",
	"终止时间": "2024-09-04",
	"聚合类型": "MONTH",
	"公司名称": "湖北国贸金属矿产有限公司"
	}
	```
- 图表:
- ![[Pasted image 20240905173531.png]]
### 例子9: 集团用户按条件查询采购额
- 用户输入: 今年上半年采购额超过1亿元的公司。
- 输出:
	```json
	{
	"指标名称": "采购额",
	"起始时间": "2024-01-01",
	"终止时间": "2024-06-30",
	"排序方式": "DESC",
	"聚合类型": "COMPANY",
	"运算符": ">",
	"值": "100000000"
	}
	```
- 图表:
- ![[Pasted image 20240905173514.png]]

### 例子10: 公司用户按商品类别查询销售额
- 用户输入: 湖北国贸能源化工有限公司今年煤炭类商品的月度销售额。
- 输出:
	```json
	{
	"指标名称": "销售额",
	"起始时间": "2024-01-01",
	"终止时间": "2024-09-04",
	"聚合类型": "MONTH",
	"公司名称": "湖北国贸能源化工有限公司",
	"商品类别": "煤炭"
	}
	```
- 图表:
- ![[Pasted image 20240905173258.png]]

# 3. 库存领域指标说明
## 数据视图字段说明
### 煤炭仓库
- **仓库名称**: 仓库的名称,分为全称和简称。
- **商品类型**: 煤炭。
- **库存重量**: 单位为吨。
- **暂估库存货值**: 库存货物结算前预估的货值,单位为元。
- **预付货款**: 已付上游供应商的货款金额,单位为元。
### 钢材仓库
- **仓库名称**: 仓库的名称,分为全称和简称。
- **商品类型**: 钢材。
- **库存数量**: 单位为件。
- **库存重量**: 单位为吨。
- **存货金额余额**: 库存货物结算前的货值,单位为元。
## 数据库视图示例
### 煤炭库存视图示例

| 仓库名称  | 商品类型 | 库存重量  | 暂估库存货值  | 预付货款    | 更新日期       |
| ----- | ---- | ----- | ------- | ------- | ---------- |
| 武汉港仓库 | 煤炭   | 10000 | 5000000 | 4000000 | 2024-03-15 |
| 黄石港仓库 | 煤炭   | 8000  | 4000000 | 3500000 | 2024-03-15 |
| 宜昌港仓库 | 煤炭   | 12000 | 6000000 | 5000000 | 2024-03-15 |
### 钢材库存视图示例

| 仓库名称 | 商品类型 | 库存数量 | 库存重量 | 存货金额余额 | 更新日期 |
|--------|--------|--------|--------|------------|--------|
| 武汉钢材仓库 | 钢材 | 5000 | 25000 | 10000000 | 2024-03-15 |
| 黄石钢材仓库 | 钢材 | 3000 | 15000 | 6000000 | 2024-03-15 |
| 宜昌钢材仓库 | 钢材 | 4000 | 20000 | 8000000 | 2024-03-15 |
## 结构化参数提取说明
- **指标名称**:
  - 类型: ENUM
  - 取值范围:
    - 库存重量
    - 暂估库存货值
    - 预付货款
    - 库存数量
    - 存货金额余额
  - 是否必填: **是**
  - 说明:指标和商品类型关联
- **商品类型**:
  - 类型: ENUM
  - 取值范围: 煤炭, 钢材
  - 是否必填: **是**
- **聚合类型**:
  - 类型: ENUM
  - 取值范围: 仓库名称, 公司名称
  - 是否必填: **是**
  - 说明:集团用户需要以公司名称聚合指标,公司用户需要从仓库聚合指标.
- **排序方式**:
  - 类型: ENUM
  - 取值范围:
    - 升序: ASC
    - 降序: DESC
  - 是否必填: **否**
- **公司名称**:
  - 类型: ENUM
  - 取值范围: 公司名称列表
  - 是否必填: **否**
  - 说明: 如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值。
- **仓库名称**:
  - 类型: ENUM
  - 取值范围: 仓库名称列表
  - 是否必填: **否**
  - 说明: 当用户指定查询具体的仓库时取值。
- **运算符**:
  - 类型: ENUM
  - 取值范围:
    - ">"
    - "<"
    - ">=" 
    - "<="
    - "="
    - "IN" ,表示在a,b之间,闭区间
    - "NOT IN" ,表示不在a,b之间,开区间
  - 是否必填: **否**
- **值**:
  - 类型: DECIMAL
  - 说明: 当运算符为IN或NOT IN时为[a,b]
  - 是否必填: **否**
## 结构化参数提取示例
### 例子1: 集团用户查询煤炭库存重量
- 用户输入: 查看今天各公司的煤炭库存重量。
- 构建会话上下文:
  ```json
  {
  "session_id":"f5a8c9d0-87f1-5g82-9c06-3c7d4f3g7b84",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天各公司的煤炭库存重量。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "库存重量",
    "商品类型": "煤炭",
    "排序方式": "DESC",
    "聚合类型": "公司名称"
  }
  ```
- 图表:
	- ![[Pasted image 20240906144302.png]]
### 例子2: 公司用户查询钢材库存数量

- 用户输入: 查看我们公司今天各仓库的钢材库存数量。
- 构建会话上下文:
  ```json
  {
  "session_id":"f5a8c9d0-87f1-5g82-9c06-3c7d4f3g7b84",
  "user_role":"COMPANY",
  "user_company":"湖北国贸金属矿产有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司今天各仓库的钢材库存数量。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "库存数量",
    "商品类型": "钢材",
    "聚合类型": "仓库名称",
    "公司名称": "湖北国贸金属矿产有限公司"
  }
  ```
- 图表:
	- ![[Pasted image 20240906144529.png]]
### 例子3: 集团用户按条件查询煤炭暂估库存货值

- 用户输入: 查看今天煤炭暂估库存货值超过1000万的公司。
- 构建会话上下文:
  ```json
  {
  "session_id":"f5a8c9d0-87f1-5g82-9c06-3c7d4f3g7b84",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天煤炭暂估库存货值超过1000万的公司。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "暂估库存货值",
    "商品类型": "煤炭",
    "排序方式": "DESC",
    "聚合类型": "公司名称",
    "运算符": ">",
    "值": "10000000"
  }
  ```
- 图表:
	- ![[Pasted image 20240906144812.png]]
# 4. 代采领域指标说明

## 数据视图字段说明

- **公司名称**: 代采业务的执行公司名称。
- **客户名称**: 委托代采的客户公司名称。
- **商品类别**: 代采的商品类别,目前主要包括煤炭和钢材。
- **存货金额余额**: 客户委托代采但尚未结算的货物金额,单位为元。计算公式为:采购已付货款 - 销售预收货款 / (1 - 【订金占比】)
- **更新日期**: 数据最后更新的日期,格式为"yyyy-mm-dd"。

## 数据库视图示例

### 代采业务视图示例

| 公司名称   | 客户名称 | 商品类别 | 客户存货金额余额 | 更新日期       |
|--------|------|------|-----------|------------|
| 国贸能化   | 客户A  | 煤炭   | 5000000    | 2024-03-15 |
| 国贸金属矿  | 客户B  | 钢材   | 3000000    | 2024-03-15 |
| 国贸能化   | 客户C  | 煤炭   | 4000000    | 2024-03-15 |
| 国贸金属矿  | 客户D  | 钢材   | 2500000    | 2024-03-15 |
| 国贸农产品  | 客户E  | 煤炭   | 3500000    | 2024-03-15 |

## 结构化参数提取说明

- **指标名称**:
  - 类型: ENUM
  - 取值范围: 代采存货金额余额
  - 是否必填: **是**

- **聚合类型**:
  - 类型: ENUM
  - 取值范围: 公司名称, 客户名称
  - 是否必填: **是**
  - 说明: 集团用户需要以公司名称聚合指标,公司用户需要以客户名称聚合指标

- **排序方式**:
  - 类型: ENUM
  - 取值范围:
    - 升序: ASC
    - 降序: DESC
  - 是否必填: **否**

- **公司名称**:
  - 类型: ENUM
  - 取值范围: 公司名称列表
  - 是否必填: **否**
  - 说明: 如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值

- **客户名称**:
  - 类型: ENUM
  - 取值范围: 客户名称列表
  - 是否必填: **否**
  - 说明: 当用户指定查询具体的客户时取值
- **运算符**:
  - 类型: ENUM
  - 取值范围:
    - ">"
    - "<"
    - ">=" 
    - "<="
    - "="
    - "IN" ,表示在a,b之间,闭区间
    - "NOT IN" ,表示不在a,b之间,开区间
  - 是否必填: **否**

- **值**:
  - 类型: DECIMAL
  - 说明: 当运算符为IN或NOT IN时为[a,b]
  - 是否必填: **否**

## 结构化参数提取示例
### 例子1: 集团用户查询各公司的代采业务情况
- 用户输入: 查看今天各公司的代采业务客户存货金额余额总和。
- 构建会话上下文:
  ```json
  {
  "session_id":"g6b9d0e1-98g2-6h93-0d17-4d8e5g4h8c95",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天各公司的代采业务客户存货金额余额总和。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "客户存货金额余额",
    "排序方式": "DESC",
    "聚合类型": "公司名称"
  }
  ```
- 图表:
![[Pasted image 20240906152809.png]]
### 例子2: 公司用户查询代采业务客户情况

- 用户输入: 查看我们公司今天各客户的代采业务存货金额余额。
- 构建会话上下文:
  ```json
  {
  "session_id":"g6b9d0e1-98g2-6h93-0d17-4d8e5g4h8c95",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司今天各客户的代采业务存货金额余额。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "客户存货金额余额",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸能源化工有限公司"
  }
  ```
- 图表:
  ![[Pasted image 20240906153153.png]]

### 例子3: 集团用户按条件查询特定公司的代采业务情况

- 用户输入: 查看今天国贸金属矿代采业务客户存货金额余额超过300万的客户。
- 构建会话上下文:
  ```json
  {
  "session_id":"g6b9d0e1-98g2-6h93-0d17-4d8e5g4h8c95",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天国贸金属矿代采业务客户存货金额余额超过300万的客户。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "客户存货金额余额",
    "排序方式": "DESC",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸金属矿产有限公司",
    "运算符": ">",
    "值": "3000000"
  }
  ```
- 图表:
  ![[Pasted image 20240906153803.png]]

好的,我理解您希望简化回款业务的数据结构。我将根据您的要求修改回款领域指标的说明文档。以下是修改后的文档:

# 5. 回款领域指标说明

## 数据视图字段说明

- **公司名称**: 执行销售业务的公司名称。
- **客户名称**: 购买商品的客户公司名称。
- **回款金额**: 客户实际支付的货款金额,单位为元。
- **回款日期**: 客户支付货款的日期,格式为"yyyy-mm-dd"。

## 数据库视图示例

### 回款业务视图示例

| 公司名称   | 客户名称 | 回款金额    | 回款日期       |
|--------|------|---------|------------|
| 国贸能化   | 客户A  | 2000000 | 2024-03-15 |
| 国贸金属矿  | 客户B  | 1500000 | 2024-03-16 |
| 国贸能化   | 客户C  | 3000000 | 2024-03-17 |
| 国贸金属矿  | 客户D  | 1000000 | 2024-03-18 |
| 国贸农产品  | 客户E  | 1800000 | 2024-03-19 |

## 结构化参数提取说明

- **指标名称**:
  - 类型: ENUM
  - 取值范围: 回款金额
  - 是否必填: **是**

- **起始时间**:
  - 类型: DATE
  - 格式: yyyy-mm-dd
  - 是否必填: **是**

- **终止时间**:
  - 类型: DATE
  - 格式: yyyy-mm-dd
  - 是否必填: **是**

- **聚合类型**:
  - 类型: ENUM
  - 取值范围: 公司名称, 客户名称, 时间维度(月,年)
  - 是否必填: **是**
  - 说明: 集团用户默认以公司名称聚合指标,公司用户默认以客户名称聚合指标

- **排序方式**:
  - 类型: ENUM
  - 取值范围:
    - 升序: ASC
    - 降序: DESC
  - 是否必填: **否**

- **公司名称**:
  - 类型: ENUM
  - 取值范围: 公司名称列表
  - 是否必填: **否**
  - 说明: 如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值

- **客户名称**:
  - 类型: ENUM
  - 取值范围: 客户名称列表
  - 是否必填: **否**
  - 说明: 当用户指定查询具体的客户时取值

- **运算符**:
  - 类型: ENUM
  - 取值范围:
    - ">"
    - "<"
    - ">=" 
    - "<="
    - "="
    - "IN" ,表示在a,b之间,闭区间
    - "NOT IN" ,表示不在a,b之间,开区间
  - 是否必填: **否**

- **值**:
  - 类型: DECIMAL
  - 说明: 当运算符为IN或NOT IN时为[a,b]
  - 是否必填: **否**

## 结构化参数提取示例

### 例子1: 集团用户查询各公司的回款情况

- 用户输入: 查看今年第一季度各公司的回款金额总和。
- 构建会话上下文:
  ```json
  {
  "session_id":"h7c0e1f2-09h3-7i04-1e28-5e9f6h5i9d06",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今年第一季度各公司的回款金额总和。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "回款金额",
    "起始时间": "2024-01-01",
    "终止时间": "2024-03-31",
    "排序方式": "DESC",
    "聚合类型": "公司名称"
  }
  ```
- 图表:
  ![[Pasted image 20240906161855.png]]

### 例子2: 公司用户查询客户回款情况

- 用户输入: 查看我们公司今年以来各客户的月度回款金额。
- 构建会话上下文:
  ```json
  {
  "session_id":"h7c0e1f2-09h3-7i04-1e28-5e9f6h5i9d06",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司今年以来各客户的月度回款金额。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "回款金额",
    "起始时间": "2024-01-01",
    "终止时间": "2024-09-04",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸能源化工有限公司"
  }
  ```
- 图表:
 ![[Pasted image 20240906162848.png]]

### 例子3: 集团用户按条件查询特定公司的回款情况

- 用户输入: 查看今年国贸金属矿单笔回款金额超过400万的客户。
- 构建会话上下文:
  ```json
  {
  "session_id":"h7c0e1f2-09h3-7i04-1e28-5e9f6h5i9d06",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今年国贸金属矿单笔回款金额超过400万的客户。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "回款金额",
    "起始时间": "2024-01-01",
    "终止时间": "2024-09-04",
    "排序方式": "DESC",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸金属矿产有限公司",
    "运算符": ">",
    "值": "2000000"
  }
  ```
- 图表:
  ![[Pasted image 20240906162905.png]]
好的,我将为您生成应收领域的指标说明文档。以下是根据之前的格式和内容整理的应收领域指标说明:

# 6. 应收领域指标说明
## 数据视图字段说明
- **公司名称**: 执行销售业务的公司名称。
- **客户名称**: 购买商品的客户公司名称。
- **应收余额**: 客户尚未支付的货款金额,单位为元。应收余额=销售结算金额-已回款金额.
- **更新日期**: 数据最后更新的日期,格式为"yyyy-mm-dd"。
## 数据库视图示例
### 应收业务视图示例

| 公司名称   | 客户名称 | 应收余额    | 更新日期       |
|--------|------|---------|------------|
| 国贸能化   | 客户A  | 3000000 | 2024-03-15 |
| 国贸金属矿  | 客户B  | 2500000 | 2024-03-15 |
| 国贸能化   | 客户C  | 4000000 | 2024-03-15 |
| 国贸金属矿  | 客户D  | 1500000 | 2024-03-15 |
| 国贸农产品  | 客户E  | 2000000 | 2024-03-15 |
## 结构化参数提取说明
- **指标名称**:
  - 类型: ENUM
  - 取值范围: 应收余额
  - 是否必填: **是**
- **聚合类型**:
  - 类型: ENUM
  - 取值范围: 公司名称, 客户名称
  - 是否必填: **是**
  - 说明: 集团用户默认以公司名称聚合指标,公司用户默认以客户名称聚合指标
- **排序方式**:
  - 类型: ENUM
  - 取值范围:
    - 升序: ASC
    - 降序: DESC
  - 是否必填: **否**
- **公司名称**:
  - 类型: ENUM
  - 取值范围: 公司名称列表
  - 是否必填: **否**
  - 说明: 如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值
- **客户名称**:
  - 类型: ENUM
  - 取值范围: 客户名称列表
  - 是否必填: **否**
  - 说明: 当用户指定查询具体的客户时取值
- **运算符**:
  - 类型: ENUM
  - 取值范围:
    - ">"
    - "<"
    - ">=" 
    - "<="
    - "="
    - "IN" ,表示在a,b之间,闭区间
    - "NOT IN" ,表示不在a,b之间,开区间
  - 是否必填: **否**
- **值**:
  - 类型: DECIMAL
  - 说明: 当运算符为IN或NOT IN时为[a,b]
  - 是否必填: **否**
## 结构化参数提取示例

### 例子1: 集团用户查询各公司的应收情况

- 用户输入: 查看今天各公司的应收余额总和。
- 构建会话上下文:
  ```json
  {
  "session_id":"i8d1f2g3-10i4-8j15-2f39-6f0g7i6j0e17",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天各公司的应收余额总和。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "应收余额",
    "排序方式": "DESC",
    "聚合类型": "公司名称"
  }
  ```
- 图表:
![[Pasted image 20240906172153.png]]

### 例子2: 公司用户查询客户应收情况

- 用户输入: 查看我们公司今天各客户的应收余额。
- 构建会话上下文:
  ```json
  {
  "session_id":"i8d1f2g3-10i4-8j15-2f39-6f0g7i6j0e17",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司今天各客户的应收余额。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "应收余额",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸能源化工有限公司"
  }
  ```
- 图表:
![[Pasted image 20240906172209.png]]
### 例子3: 集团用户按条件查询特定公司的应收情况

- 用户输入: 查看今天国贸金属矿应收余额超过200万的客户。
- 构建会话上下文:
  ```json
  {
  "session_id":"i8d1f2g3-10i4-8j15-2f39-6f0g7i6j0e17",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天国贸金属矿应收余额超过300万的客户。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "应收余额",
    "排序方式": "DESC",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸金属矿产有限公司",
    "运算符": ">",
    "值": "3000000"
  }
  ```
- 图表:
![[Pasted image 20240906172250.png]]

非常感谢您的反馈。我将根据您的要求修改帐龄的区间。以下是修改后的帐龄领域指标说明文档：

# 7. 帐龄领域指标说明

## 数据视图字段说明

- **公司名称**: 执行销售业务的公司名称。
- **客户名称**: 购买商品的客户公司名称。
- **账款金额**: 销售结算的货款金额,单位为元。
- **账龄**: 销售结算金额到回款的时间长度,分为以下几个区间:
  - 1-30天
  - 31-90天
  - 91-120天
  - 121-180天
  - 180天以上

## 数据库视图示例

### 帐龄业务视图示例

| 公司名称  | 客户名称 | 账款金额    | 账龄       |
| ----- | ---- | ------- | -------- |
| 国贸能化  | 客户A  | 1000000 | 1-30天    |
| 国贸金属矿 | 客户B  | 1500000 | 31-90天   |
| 国贸能化  | 客户C  | 2000000 | 91-120天  |
| 国贸金属矿 | 客户D  | 500000  | 121-180天 |
| 国贸农产品 | 客户E  | 800000  | 180天以上   |

## 结构化参数提取说明

- **指标名称**:
  - 类型: ENUM
  - 取值范围: 账款金额
  - 是否必填: **是**

- **聚合类型**:
  - 类型: ENUM
  - 取值范围: 公司名称, 客户名称, 账龄
  - 是否必填: **是**
  - 说明: 集团用户默认以公司名称聚合指标,公司用户默认以客户名称聚合指标

- **排序方式**:
  - 类型: ENUM
  - 取值范围:
    - 升序: ASC
    - 降序: DESC
  - 是否必填: **否**

- **公司名称**:
  - 类型: ENUM
  - 取值范围: 公司名称列表
  - 是否必填: **否**
  - 说明: 如果用户身份为公司用户,可以取用户所属公司初始化,后续根据上下文动态取值

- **客户名称**:
  - 类型: ENUM
  - 取值范围: 客户名称列表
  - 是否必填: **否**
  - 说明: 当用户指定查询具体的客户时取值

- **账龄**:
  - 类型: ENUM
  - 取值范围: 1-30天, 31-90天, 91-120天, 121-180天, 180天以上
  - 是否必填: **否**
  - 说明: 当用户指定查询特定账龄区间时取值

- **运算符**:
  - 类型: ENUM
  - 取值范围:
    - ">"
    - "<"
    - ">=" 
    - "<="
    - "="
    - "IN" ,表示在a,b之间,闭区间
    - "NOT IN" ,表示不在a,b之间,开区间
  - 是否必填: **否**

- **值**:
  - 类型: DECIMAL
  - 说明: 当运算符为IN或NOT IN时为[a,b]
  - 是否必填: **否**

## 结构化参数提取示例

### 例子1: 集团用户查询各公司的帐龄情况

- 用户输入: 查看今天各公司的账龄分布情况。
- 构建会话上下文:
  ```json
  {
  "session_id":"j9e2g3h4-11j5-9k26-3g40-7g1h8j7k1f28",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天各公司的账龄分布情况。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "排序方式": "DESC",
    "聚合类型": "账龄"
  }
  ```
- 图表:
  

### 例子2: 公司用户查询客户帐龄情况

- 用户输入: 查看我们公司今天各客户的账龄分布。
- 构建会话上下文:
  ```json
  {
  "session_id":"j9e2g3h4-11j5-9k26-3g40-7g1h8j7k1f28",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司今天各客户的账龄分布。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸能源化工有限公司"
  }
  ```
- 图表:
  

### 例子3: 集团用户按条件查询特定公司的帐龄情况

- 用户输入: 查看今天国贸金属矿账龄超过90天的客户。
- 构建会话上下文:
  ```json
  {
  "session_id":"j9e2g3h4-11j5-9k26-3g40-7g1h8j7k1f28",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天国贸金属矿账龄超过90天的客户。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "排序方式": "DESC",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸金属矿产有限公司",
    "账龄": ["91-120天", "121-180天", "180天以上"]
  }
  ```
- 图表:
  
### 例子4: 集团用户查询特定账龄区间的情况

- 用户输入: 查看今天各公司账龄在91-180天的账款金额。
- 构建会话上下文:
  ```json
  {
  "session_id":"k0f3h4i5-12k6-0l37-4h51-8h2i9k8l2g39",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"查看今天各公司账龄在91-180天的账款金额。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "排序方式": "DESC",
    "聚合类型": "公司名称",
    "账龄": ["91-120天", "121-180天"]
  }
  ```
- 图表:
  (此处插入堆叠柱状图)

### 例子5: 公司用户查询长账龄客户

- 用户输入: 查看我们公司账龄超过180天的客户及其账款金额。
- 构建会话上下文:
  ```json
  {
  "session_id":"k0f3h4i5-12k6-0l37-4h51-8h2i9k8l2g39",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司账龄超过180天的客户及其账款金额。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "排序方式": "DESC",
    "聚合类型": "客户名称",
    "公司名称": "湖北国贸能源化工有限公司",
    "账龄": ["180天以上"]
  }
  ```
- 图表:
  (此处插入相应的图表)

### 例子6: 集团用户比较不同账龄区间的账款金额

- 用户输入: 比较今天各公司在不同账龄区间的账款金额分布。
- 构建会话上下文:
  ```json
  {
  "session_id":"l1g4i5j6-13l7-1m48-5i62-9i3j0l9m3h40",
  "user_role":"GROUP",
  "date":"2024-09-04",
  "user_input":"比较今天各公司在不同账龄区间的账款金额分布。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "聚合类型": "账龄",
    "排序方式": "ASC"
  }
  ```
- 图表:
  (此处插入相应的图表,可能是堆叠柱状图或多系列柱状图)

### 例子7: 公司用户查询特定客户的账龄分布

- 用户输入: 查看我们公司客户A的账龄分布情况。
- 构建会话上下文:
  ```json
  {
  "session_id":"l1g4i5j6-13l7-1m48-5i62-9i3j0l9m3h40",
  "user_role":"COMPANY",
  "user_company":"湖北国贸能源化工有限公司",
  "date":"2024-09-04",
  "user_input":"查看我们公司客户A的账龄分布情况。",
  ……
  }
  ```
- 输出:
  ```json
  {
    "指标名称": "账款金额",
    "聚合类型": "账龄",
    "公司名称": "湖北国贸能源化工有限公司",
    "客户名称": "客户A"
  }
  ```
- 图表:
  (此处插入相应的图表,可能是饼图或环形图)

这些新增的例子涵盖了更多帐龄相关的查询场景,包括特定账龄区间的查询、长账龄客户的识别、不同账龄区间的比较,以及特定客户的账龄分布情况。这些例子可以帮助用户更全面地理解和使用帐龄相关的数据查询功能。
# 图表样式说明
**图表标题**: 用户输入的问题文本
**图表类型**:售额、采购额、毛利润采用柱状图,毛利率采用折线图
**图表尺寸**:按设计规范执行,示例中暂按360px宽300px高
**柱图数据条宽度**:按设计规范执行
**柱图数据条间距**:按设计规范执行
**图表配色**:按设计规范执行,示例中柱配色暂按rgb(255,165,0)填充
**X轴标签**:按聚合类型,可以为(月份,年份,公司名称,客户名称)
**Y轴标签**:{指标名称}(元),单位根据数字大小自适应
**其他**:字体,字高,宽高比等由设计深化
# 数据埋点设计
为了收集用户数据迭代产品，对以下数据进行埋点采集.

# 不足与待完善的部分
快照型数据无法生成时间序列的曲线,例如想了解某公司应收余额的波动曲线，如下图，目前的数据存储无法实现。
![[Pasted image 20240906171221.png]]
![[Pasted image 20240906171512.png]]
# 附录
## 提示词样例
## 集团、公司、客户、仓库之间的关系
- 国贸集团有多个分公司,每个分公司有自己的客户列表,关系如下:
```markdown
- 集团名称
  - 分公司A
    - 客户1
    - 客户2
    - 客户3
  - 分公司B
    - 客户4
    - 客户5
  - 分公司C
    - 客户6
    - 客户7
    - 客户8
``` 
- 集团、公司、仓库之间的关系:
```markdown
- 集团名称
  - 分公司A
    - 仓库1
    - 仓库2
    - 仓库3
  - 分公司B
    - 仓库4
    - 仓库5
  - 分公司C
    - 仓库6
    - 仓库7
    - 仓库8
``` 